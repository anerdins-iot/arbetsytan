generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}

model KnowledgeEntity {
  id         String                 @id @default(cuid())
  entityType String
  entityId   String
  metadata   Json
  confidence Float
  lastSeen   DateTime               @default(now())
  tenantId   String
  embedding  Unsupported("vector")?

  @@index([tenantId, entityType, entityId])
}

model KnowledgeRelation {
  id           String @id @default(cuid())
  fromEntityId String
  toEntityId   String
  relationType String
  metadata     Json
  tenantId     String

  @@index([tenantId, fromEntityId, toEntityId])
}

model AIMessage {
  id              String      @id @default(cuid())
  direction       AIDirection
  type            String
  content         String
  read            Boolean     @default(false)
  createdAt       DateTime    @default(now())
  userId          String
  projectId       String
  parentId        String?
  AIMessage       AIMessage?  @relation("AIMessageToAIMessage", fields: [parentId], references: [id])
  other_AIMessage AIMessage[] @relation("AIMessageToAIMessage")
  project         Project     @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user            User        @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Account {
  id                String  @id @default(cuid())
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  user              User    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([provider, providerAccountId])
}

model ActivityLog {
  id        String   @id @default(cuid())
  action    String
  entity    String
  entityId  String
  metadata  Json     @default("{}")
  createdAt DateTime @default(now())
  projectId String
  actorId   String
  actor     User     @relation(fields: [actorId], references: [id])
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Automation {
  id                   String            @id @default(cuid())
  name                 String
  description          String?
  triggerAt            DateTime
  recurrence           String?
  timezone             String            @default("Europe/Stockholm")
  actionTool           String
  actionParams         Json
  status               AutomationStatus  @default(PENDING)
  projectId            String?
  createdBy            AutomationCreator @default(USER)
  sourceConversationId String?
  userId               String
  tenantId             String
  lastRunAt            DateTime?
  nextRunAt            DateTime?
  createdAt            DateTime          @default(now())
  updatedAt            DateTime           @updatedAt
  project              Project?          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  AutomationLog        AutomationLog[]

  @@index([projectId])
  @@index([tenantId, status, triggerAt])
  @@index([userId, tenantId])
}

model AutomationLog {
  id           String              @id @default(cuid())
  status       AutomationLogStatus
  result       Json?
  errorMessage String?
  executedAt   DateTime            @default(now())
  durationMs   Int?
  automationId String
  Automation   Automation          @relation(fields: [automationId], references: [id], onDelete: Cascade)

  @@index([automationId, executedAt])
}

model Comment {
  id        String   @id @default(cuid())
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime   @updatedAt
  taskId    String
  authorId  String
  task      Task     @relation(fields: [taskId], references: [id], onDelete: Cascade)
}

model DiscordCategory {
  id                String             @id @default(cuid())
  tenantId          String
  tenant            Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  name              String
  discordCategoryId String?
  type              DiscordCategoryType
  sortOrder         Int                @default(0)
  createdAt         DateTime           @default(now())

  @@unique([tenantId, type])
}

model DiscordProjectChannel {
  id                String   @id @default(cuid())
  discordChannelId  String   @unique
  discordCategoryId String?
  projectId         String
  tenantId          String
  channelType       String   // "general", "tasks", "files", "activity"
  syncEnabled       Boolean  @default(true)
  lastSyncedAt      DateTime?
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  project           Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([projectId])
  @@index([tenantId])
  @@index([discordChannelId])
}

model DiscordMessage {
  id               String   @id @default(cuid())
  discordMessageId String   @unique
  messageId        String
  message          Message  @relation(fields: [messageId], references: [id], onDelete: Cascade)
  discordChannelId String
  discordUserId    String
  createdAt        DateTime @default(now())

  @@index([discordChannelId])
}

model DiscordRoleMapping {
  id              String   @id @default(cuid())
  tenantId        String
  tenant          Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  systemRole      String
  discordRoleId   String
  discordRoleName String
  color           String
  createdAt       DateTime @default(now())

  @@unique([tenantId, systemRole])
  @@index([discordRoleId])
}

model Conversation {
  id              String           @id @default(cuid())
  type            ConversationType
  title           String?
  summary         String?
  provider        AIProvider       @default(CLAUDE)
  discordChannelId String?
  discordUserId   String?
  createdAt       DateTime         @default(now())
  updatedAt       DateTime         @updatedAt
  userId          String
  projectId       String?
  project         Project?         @relation(fields: [projectId], references: [id])
  user            User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages        Message[]
  messageChunks   MessageChunk[]

  @@index([discordChannelId])
  @@index([discordUserId])
}

/// This table contains check constraints and requires additional setup for migrations. Visit https://pris.ly/d/check-constraints for more info.
model DocumentChunk {
  id        String                 @id @default(cuid())
  content   String
  metadata  Json                   @default("{}")
  page      Int?
  createdAt DateTime               @default(now())
  fileId    String
  projectId String?
  embedding Unsupported("vector")?
  tenantId  String
  userId    String?
  file      File                   @relation(fields: [fileId], references: [id], onDelete: Cascade)
  project   Project?               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant    Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User?                  @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model DocumentTemplate {
  id                String   @id @default(cuid())
  name              String
  description       String?
  category          String
  fileId            String
  expectedVariables Json?    @default("[]")
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt
  tenantId          String
  file              File     @relation(fields: [fileId], references: [id], onDelete: Cascade)
  tenant            Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([tenantId, category])
}

model EmailAttachment {
  id          String   @id @default(cuid())
  filename    String
  contentType String
  size        Int
  bucket      String
  key         String
  emailLogId  String
  createdAt   DateTime @default(now())
  emailLog    EmailLog @relation(fields: [emailLogId], references: [id], onDelete: Cascade)

  @@index([emailLogId])
}

model EmailChunk {
  id         String                 @id @default(cuid())
  content    String
  embedding  Unsupported("vector")?
  chunkIndex Int
  createdAt  DateTime               @default(now())
  emailLogId String
  tenantId   String
  projectId  String?
  userId     String
  emailLog   EmailLog               @relation(fields: [emailLogId], references: [id], onDelete: Cascade)
  project    Project?               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant     Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user       User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([emailLogId])
  @@index([projectId])
  @@index([tenantId])
  @@index([userId])
}

model EmailConversation {
  id            String         @id @default(cuid())
  tenantId      String
  userId        String
  projectId     String?
  externalEmail String
  externalName  String?
  trackingCode  String         @unique
  subject       String
  lastMessageAt DateTime       @default(now())
  unreadCount   Int            @default(0)
  isArchived    Boolean        @default(false)
  createdAt     DateTime       @default(now())
  updatedAt     DateTime     @updatedAt
  isUnassigned  Boolean        @default(false)
  project       Project?       @relation(fields: [projectId], references: [id])
  tenant        Tenant         @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user          User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  messages      EmailMessage[]

  @@index([tenantId, userId])
  @@index([trackingCode])
}

model EmailLog {
  id              String            @id @default(cuid())
  direction       EmailDirection
  status          EmailStatus       @default(QUEUED)
  from            String
  to              Json
  cc              Json?
  bcc             Json?
  subject         String
  body            String
  htmlBody        String?
  resendMessageId String?           @unique
  resendError     String?
  tenantId        String
  userId          String
  projectId       String?
  createdAt       DateTime          @default(now())
  sentAt          DateTime?
  deliveredAt     DateTime?
  bouncedAt       DateTime?
  failedAt        DateTime?
  attachments     EmailAttachment[]
  EmailChunk      EmailChunk[]
  project         Project?          @relation(fields: [projectId], references: [id])
  tenant          Tenant            @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  EmailMessage    EmailMessage?

  @@index([resendMessageId])
  @@index([status])
  @@index([tenantId, createdAt])
  @@index([tenantId, projectId])
  @@index([tenantId, userId])
}

model EmailMessage {
  id                String            @id @default(cuid())
  conversationId    String
  emailLogId        String?           @unique
  direction         EmailDirection
  fromEmail         String
  fromName          String?
  toEmail           String
  subject           String
  bodyText          String?
  bodyHtml          String?
  isRead            Boolean           @default(false)
  sentAt            DateTime?
  receivedAt        DateTime?
  createdAt         DateTime          @default(now())
  conversation      EmailConversation @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  emailLog          EmailLog?         @relation(fields: [emailLogId], references: [id])

  @@index([conversationId])
}

model EmailTemplate {
  id           String   @id @default(cuid())
  name         String
  subject      String
  htmlTemplate String
  variables    Json     @default("[]")
  locale       String
  createdAt    DateTime @default(now())
  updatedAt    DateTime    @updatedAt
  tenantId     String
  tenant       Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([tenantId, name, locale])
  @@index([tenantId, locale])
}

model File {
  id              String          @id @default(cuid())
  name            String
  type            String
  size            Int
  bucket          String
  key             String
  ocrText         String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime       @updatedAt
  projectId       String?
  uploadedById    String
  aiAnalysis      String?
  label           String?
  userDescription String?
  parentFileId    String?
  versionNumber   Int             @default(1)
  chunks             DocumentChunk[]
  documentTemplates  DocumentTemplate[]
  noteAttachments    NoteAttachment[]
  parentFile         File?           @relation("FileToFile", fields: [parentFileId], references: [id])
  childVersions      File[]          @relation("FileToFile")
  project            Project?        @relation(fields: [projectId], references: [id], onDelete: Cascade)
  user               User            @relation(fields: [uploadedById], references: [id])
  analyses           FileAnalysis[]
}

model FileAnalysis {
  id        String   @id @default(cuid())
  content   String
  prompt    String?
  model     String?
  type      String   @default("auto")
  createdAt DateTime @default(now())
  fileId    String
  tenantId  String
  projectId String?
  userId    String?
  file      File     @relation(fields: [fileId], references: [id], onDelete: Cascade)
  project   Project? @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User?    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([fileId])
  @@index([projectId])
  @@index([tenantId])
}

model Invitation {
  id          String           @id @default(cuid())
  email       String
  role        Role             @default(WORKER)
  status      InvitationStatus @default(PENDING)
  token       String           @unique
  expiresAt   DateTime
  createdAt   DateTime         @default(now())
  tenantId    String
  invitedById String
  tenant      Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@unique([email, tenantId])
}

model Membership {
  id             String           @id @default(cuid())
  role           Role             @default(WORKER)
  permissions    Json             @default("{}")
  createdAt      DateTime         @default(now())
  updatedAt      DateTime      @updatedAt
  userId         String
  tenantId       String
  /** Unique per tenant: used in reply-to address (userSlug.tenantSlug@domain). Based on first name; on collision add . + 3 letters of last name. */
  emailSlug     String?
  tenant         Tenant           @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user           User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  projectMembers ProjectMember[]
  taskAssignments TaskAssignment[]

  @@unique([userId, tenantId])
  @@unique([tenantId, emailSlug])
}

model Message {
  id              String           @id @default(cuid())
  role            MessageRole
  content         String
  createdAt       DateTime         @default(now())
  conversationId  String
  projectId       String?
  conversation    Conversation     @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  project         Project?         @relation(fields: [projectId], references: [id])
  messageChunks   MessageChunk[]
  discordMessages DiscordMessage[]
}

model MessageChunk {
  id             String                 @id @default(cuid())
  content        String
  embedding      Unsupported("vector")?
  chunkIndex     Int                    @default(0)
  createdAt      DateTime               @default(now())
  messageId      String
  conversationId String
  tenantId       String
  userId         String
  projectId      String?
  conversation   Conversation           @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  message        Message                @relation(fields: [messageId], references: [id], onDelete: Cascade)
  project        Project?               @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant         Tenant                 @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user           User                   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([conversationId])
  @@index([messageId])
  @@index([tenantId, userId])
  @@index([tenantId, userId, projectId])
}

model Note {
  id          String           @id @default(cuid())
  title       String           @default("")
  content     String
  category    String?
  isPinned    Boolean          @default(false)
  projectId   String?
  createdById String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  createdBy   User             @relation(fields: [createdById], references: [id])
  project     Project?         @relation(fields: [projectId], references: [id], onDelete: Cascade)
  attachments NoteAttachment[]

  @@index([createdById, projectId])
  @@index([projectId, category])
  @@index([projectId, createdAt])
}

model NoteAttachment {
  id        String   @id @default(cuid())
  noteId    String
  fileId    String
  createdAt DateTime @default(now())
  note      Note     @relation(fields: [noteId], references: [id], onDelete: Cascade)
  file      File     @relation(fields: [fileId], references: [id], onDelete: Cascade)

  @@unique([noteId, fileId])
  @@index([noteId])
  @@index([fileId])
}

model ShoppingList {
  id          String             @id @default(cuid())
  title       String
  projectId   String?
  tenantId    String
  createdById String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  isArchived  Boolean            @default(false)
  items       ShoppingListItem[]
  createdBy   User               @relation(fields: [createdById], references: [id])
  project     Project?           @relation(fields: [projectId], references: [id], onDelete: Cascade)
  tenant      Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([projectId])
  @@index([createdById])
}

model ShoppingListItem {
  id            String       @id @default(cuid())
  listId        String
  name          String
  articleNo     String?
  brand         String?
  supplier      String?
  quantity      Float        @default(1)
  unit          String?
  price         Float?
  imageUrl      String?
  productUrl    String?
  notes         String?
  isChecked     Boolean      @default(false)
  checkedAt     DateTime?
  sortOrder     Int          @default(0)
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  list          ShoppingList @relation(fields: [listId], references: [id], onDelete: Cascade)

  @@index([listId])
}

model NoteCategory {
  id        String    @id @default(cuid())
  name      String
  slug      String
  color     String?
  tenantId  String
  projectId String?
  createdAt DateTime  @default(now())
  updatedAt DateTime  @updatedAt
  tenant    Tenant    @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  project   Project?  @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([tenantId, projectId, slug])
  @@index([tenantId])
  @@index([tenantId, projectId])
}

model Notification {
  id        String                 @id @default(cuid())
  title     String
  body      String
  channel   NotificationChannel
  read      Boolean                @default(false)
  sent      Boolean                @default(false)
  createdAt DateTime               @default(now())
  userId    String
  projectId String?
  eventType NotificationEventType?
  taskId    String?
  project   Project?               @relation(fields: [projectId], references: [id])
  task      Task?                  @relation(fields: [taskId], references: [id])
  user      User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model NotificationPreference {
  id                        String   @id @default(cuid())
  pushEnabled               Boolean  @default(false)
  emailTaskAssigned         Boolean  @default(true)
  emailDeadlineTomorrow     Boolean  @default(true)
  emailProjectStatusChanged Boolean  @default(true)
  createdAt                 DateTime @default(now())
  updatedAt                 DateTime                 @updatedAt
  userId                    String
  tenantId                  String
  tenant                    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user                      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, tenantId])
}

model Project {
  id                String              @id @default(cuid())
  name              String
  description       String?
  status            ProjectStatus       @default(ACTIVE)
  address           String?
  discordChannelId  String?             @unique
  discordChannelName String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime         @updatedAt
  tenantId          String
  aIMessages       AIMessage[]
  activityLogs     ActivityLog[]
  automations      Automation[]
  conversations    Conversation[]
  documentChunks   DocumentChunk[]
  emailChunks      EmailChunk[]
  emailConversations EmailConversation[]
  emailLogs        EmailLog[]
  files            File[]
  fileAnalyses     FileAnalysis[]
  messages         Message[]
  messageChunks    MessageChunk[]
  notes            Note[]
  noteCategories   NoteCategory[]
  notifications    Notification[]
  shoppingLists    ShoppingList[]
  quotes           Quote[]
  tenant           Tenant              @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  projectMembers   ProjectMember[]
  tasks            Task[]
  timeEntries      TimeEntry[]
  discordChannels  DiscordProjectChannel[]
}

model ProjectMember {
  id           String     @id @default(cuid())
  createdAt    DateTime   @default(now())
  projectId    String
  membershipId String
  membership   Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  project      Project    @relation(fields: [projectId], references: [id], onDelete: Cascade)

  @@unique([projectId, membershipId])
}

model PushSubscription {
  id        String   @id @default(cuid())
  endpoint  String
  p256dhKey String
  authKey   String
  userAgent String?
  createdAt DateTime @default(now())
  updatedAt DateTime   @updatedAt
  userId    String
  tenantId  String
  tenant    Tenant   @relation(fields: [tenantId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([tenantId, endpoint])
}

model Session {
  id           String   @id @default(cuid())
  sessionToken String   @unique
  userId       String
  expires      DateTime
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Subscription {
  id                   String             @id @default(cuid())
  stripeSubscriptionId String?            @unique
  status               SubscriptionStatus @default(ACTIVE)
  currentPeriodEnd     DateTime?
  createdAt            DateTime           @default(now())
  updatedAt            DateTime           @updatedAt
  tenantId             String             @unique
  stripePriceId        String?
  currentPeriodStart   DateTime?
  trialEndsAt          DateTime?
  canceledAt           DateTime?
  tenant               Tenant             @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model Task {
  id             String           @id @default(cuid())
  title          String
  description    String?
  status         TaskStatus       @default(TODO)
  priority       Priority         @default(MEDIUM)
  deadline       DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime      @updatedAt
  projectId      String
  comments       Comment[]
  notifications  Notification[]
  project        Project          @relation(fields: [projectId], references: [id], onDelete: Cascade)
  assignments    TaskAssignment[]
  timeEntries    TimeEntry[]
}

model TaskAssignment {
  id           String     @id @default(cuid())
  createdAt    DateTime   @default(now())
  taskId       String
  membershipId String
  membership   Membership @relation(fields: [membershipId], references: [id], onDelete: Cascade)
  task         Task       @relation(fields: [taskId], references: [id], onDelete: Cascade)

  @@unique([taskId, membershipId])
}

model Tenant {
  id                     String                   @id @default(cuid())
  name                   String
  orgNumber              String?
  stripeCustomerId       String?                  @unique
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime                 @updatedAt
  address                String?
  inboxCode              String?                  @unique
  /** Human-readable slug for reply-to (e.g. anerdins-el). Lookup by slug in inbound mail. */
  slug                   String?                  @unique
  discordGuildId         String?                  @unique
  discordBotEnabled      Boolean                  @default(false)
  DocumentChunk          DocumentChunk[]
  DiscordCategory        DiscordCategory[]
  DiscordRoleMapping     DiscordRoleMapping[]
  DocumentTemplate       DocumentTemplate[]
  EmailChunk             EmailChunk[]
  EmailConversation      EmailConversation[]
  EmailLog               EmailLog[]
  EmailTemplate          EmailTemplate[]
  FileAnalysis           FileAnalysis[]
  Invitation             Invitation[]
  Membership             Membership[]
  MessageChunk           MessageChunk[]
  NoteCategory           NoteCategory[]
  NotificationPreference NotificationPreference[]
  Project                Project[]
  PushSubscription       PushSubscription[]
  ShoppingList           ShoppingList[]
  Quote                  Quote[]
  Subscription           Subscription?
  TimeEntry              TimeEntry[]
  DiscordProjectChannel  DiscordProjectChannel[]
}

model TimeEntry {
  id          String        @id @default(cuid())
  description String?
  minutes     Int
  date        DateTime
  createdAt   DateTime      @default(now())
  updatedAt   DateTime   @updatedAt
  taskId      String?
  projectId   String?
  userId      String
  entryType   TimeEntryType @default(WORK)
  tenantId    String
  project     Project?      @relation(fields: [projectId], references: [id], onDelete: Cascade)
  task        Task?         @relation(fields: [taskId], references: [id])
  tenant      Tenant        @relation(fields: [tenantId], references: [id], onDelete: Cascade)
}

model User {
  id                     String                   @id @default(cuid())
  name                   String?
  email                  String                   @unique
  emailVerified          DateTime?
  image                  String?
  password               String?
  isSuperAdmin           Boolean                  @default(false)
  locale                 String                   @default("sv")
  pushToken              String?
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime              @updatedAt
  failedLoginAttempts    Int                      @default(0)
  lockedAt               DateTime?
  phone                  String?
  bio                    String?
  AIMessage              AIMessage[]
  Account                Account[]
  ActivityLog            ActivityLog[]
  Conversation           Conversation[]
  DocumentChunk          DocumentChunk[]
  EmailChunk             EmailChunk[]
  EmailConversation      EmailConversation[]
  EmailLog               EmailLog[]
  File                   File[]
  FileAnalysis           FileAnalysis[]
  memberships            Membership[]
  messageChunks          MessageChunk[]
  notes                  Note[]
  notifications          Notification[]
  notificationPreferences NotificationPreference[]
  pushSubscriptions      PushSubscription[]
  sessions               Session[]
  shoppingLists          ShoppingList[]
  createdQuotes          Quote[]
}

model VerificationToken {
  identifier String
  token      String   @unique
  expires    DateTime

  @@unique([identifier, token])
}

enum AIDirection {
  PROJECT_TO_PERSONAL
  PERSONAL_TO_PROJECT
}

enum AIProvider {
  CLAUDE
  CLAUDE_HAIKU
  CLAUDE_SONNET
  OPENAI
  MISTRAL
  MISTRAL_LARGE
  MISTRAL_SMALL
  GROK_FAST
  GEMINI_PRO
  GEMINI_FLASH
}

enum AutomationCreator {
  USER
  AI
}

enum AutomationLogStatus {
  SUCCESS
  FAILED
  SKIPPED
}

enum AutomationStatus {
  PENDING
  ACTIVE
  PAUSED
  COMPLETED
  FAILED
  CANCELLED
}

enum ConversationType {
  PERSONAL
  PROJECT
}

enum DiscordCategoryType {
  PROJECTS
  SUPPORT
  GENERAL
  WELCOME
  CUSTOM
}

enum EmailDirection {
  INBOUND
  OUTBOUND
}

enum EmailStatus {
  QUEUED
  SENT
  DELIVERED
  BOUNCED
  FAILED
}

enum InvitationStatus {
  PENDING
  ACCEPTED
  EXPIRED
}

enum MessageRole {
  USER
  ASSISTANT
}

enum NotificationChannel {
  IN_APP
  PUSH
  EMAIL
}

enum NotificationEventType {
  TASK_ASSIGNED
  DEADLINE_SOON
  PROJECT_STATUS_CHANGED
  EMAIL_RECEIVED
}

enum Priority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum ProjectStatus {
  ACTIVE
  PAUSED
  COMPLETED
  ARCHIVED
}

enum Role {
  ADMIN
  PROJECT_MANAGER
  WORKER
}

enum SubscriptionStatus {
  ACTIVE
  PAST_DUE
  CANCELED
  TRIALING
}

enum TaskStatus {
  TODO
  IN_PROGRESS
  DONE
}

enum TimeEntryType {
  WORK
  VACATION
  SICK
  VAB
  PARENTAL
  EDUCATION
  OTHER
}

model Quote {
  id              String      @id @default(cuid())
  quoteNumber     String
  tenantId        String
  projectId       String?
  createdById     String
  customerId      String?
  customerName    String?
  customerEmail   String?
  customerPhone   String?
  customerAddress String?
  title           String
  description     String?
  status          QuoteStatus @default(DRAFT)
  validUntil      DateTime?
  notes           String?
  laborCost       Float?
  discountPercent Float?
  taxPercent      Float       @default(25)
  currency        String      @default("SEK")
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt
  sentAt          DateTime?
  acceptedAt      DateTime?
  rejectedAt      DateTime?
  items           QuoteItem[]
  createdBy       User        @relation(fields: [createdById], references: [id])
  project         Project?    @relation(fields: [projectId], references: [id])
  tenant          Tenant      @relation(fields: [tenantId], references: [id], onDelete: Cascade)

  @@index([tenantId])
  @@index([projectId])
  @@index([createdById])
  @@index([status])
  @@index([tenantId, status])
}

model QuoteItem {
  id          String   @id @default(cuid())
  quoteId     String
  name        String
  articleNo   String?
  brand       String?
  supplier    String?
  description String?
  quantity    Float    @default(1)
  unit        String?
  unitPrice   Float
  discount    Float?
  imageUrl    String?
  productUrl  String?
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  quote       Quote    @relation(fields: [quoteId], references: [id], onDelete: Cascade)

  @@index([quoteId])
}

enum QuoteStatus {
  DRAFT
  SENT
  ACCEPTED
  REJECTED
  EXPIRED
}
